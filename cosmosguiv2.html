<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cosmos GUI V2</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #000;
    }
    #stars {
      position: fixed;
      width: 100vw;
      height: 100vh;
      top: 0;
      left: 0;
      z-index: 0;
    }
    .star {
      position: absolute;
      background: white;
      border-radius: 50%;
      filter: blur(1px);
      pointer-events: none;
    }
    #core {
      position: fixed;
      width: 100vw;
      height: 100vh;
      top: 0;
      left: 0;
      z-index: 1;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div id="stars"></div>
  <div id="core"></div>
  <script>
    // Arka plan: Uzakta kayan yıldızlar
    const stars = document.getElementById("stars");
    for (let i = 0; i < 300; i++) {
      const star = document.createElement("div");
      star.classList.add("star");
      star.style.width = Math.random() * 1.2 + "px";
      star.style.height = star.style.width;
      star.style.left = Math.random() * 100 + "vw";
      star.style.top = Math.random() * 100 + "vh";
      star.style.opacity = Math.random() * 0.5 + 0.2;
      stars.appendChild(star);
    }

    // Merkez nesne
    const core = document.getElementById("core");
    let isClose = false;

    // Dönme animasyonunu ekle (başta)
    const style = document.createElement("style");
    style.textContent = `
      @keyframes spin {
        from { transform: translate(-50%, -1px) rotate(0deg); }
        to   { transform: translate(-50%, -1px) rotate(360deg); }
      }
    `;
    document.head.appendChild(style);

    document.addEventListener("mousemove", (e) => {
      const dx = e.clientX - window.innerWidth / 2;
      const dy = e.clientY - window.innerHeight / 2;
      const distance = Math.sqrt(dx * dx + dy * dy);

      if (distance < 100 && !isClose) {
        isClose = true;

        // Detaylı galaksi çekirdeği ekle
        core.innerHTML = `
          <div style="
            width: 120px; 
            height: 120px; 
            background: radial-gradient(circle, #000, #111, #001122);
            border-radius: 50%;
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 40px #00FFAA;
            overflow: hidden;
          ">
            <div style="
              position: absolute;
              width: 60%;
              height: 60%;
              background: #314159;
              border-radius: 50%;
              top: 20%; left: 20%;
              box-shadow: inset 0 0 20px #161803;
            "></div>
            <div style="
              position: absolute;
              width: 20px; height: 2px;
              background: #00FFAA;
              top: 50%; left: 50%;
              transform: translate(-50%, -1px);
              animation: spin 8s linear infinite;
            "></div>
          </div>
        `;

        // Yıldızlar netleşir
        document.querySelectorAll(".star").forEach(s => {
          s.style.transition = "0.6s";
          s.style.opacity = "0.9";
          s.style.filter = "blur(0)";
        });

      } else if (distance >= 100 && isClose) {
        isClose = false;
        core.innerHTML = ""; // Sadece içeriği temizle

        // Yıldızlar bulanıklaşır
        document.querySelectorAll(".star").forEach(s => {
          s.style.transition = "0.6s";
          s.style.opacity = Math.random() * 0.5 + 0.2;
        });
      }
    });
  </script>
  <!-- Control Panel for Tamga Generation -->
  <div id="panel" style="position:fixed;top:10px;left:10px;z-index:2;background:#111;padding:10px;border-radius:5px;color:#fff;font-family:sans-serif;">
    <h3 style="margin:0 0 8px;">Generate Tamga</h3>
    <textarea id="extra_info" placeholder="Extra Info" style="width:200px;height:40px;"></textarea><br/>
    <button id="generate" style="margin-top:5px;">Generate</button>
    <div id="result" style="margin-top:8px;"></div>
  </div>
  <!-- Socket.IO Client from CDN -->
  <script src="https://cdn.socket.io/5.5.1/socket.io.min.js"></script>
  <script>
    const socket = io();
    socket.on('tamga_created', data => {
      const resDiv = document.getElementById('result');
      resDiv.innerHTML += `<div style="margin-top:5px;color:#0f0;">Tamga Created: ${data.tamga_id}</div>`;
    });
    document.getElementById('generate').addEventListener('click', () => {
      const extra = document.getElementById('extra_info').value;
      fetch('/api/tamga', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({extra_info: extra, stars: [], emotion:'birlik'})
      })
      .then(r => r.json())
      .then(data => {
        const resDiv = document.getElementById('result');
        if (data.error) {
          resDiv.innerHTML = `<div style="color:#f00;">Error: ${data.error}</div>`;
        } else {
          const tamga = data.tamga_id;
          resDiv.innerHTML += `<div style="color:#0f0;">Response ID: ${tamga}</div>`;
          resDiv.innerHTML += `<div><a href="${tamga}.png" style="color:#0ff;">Download Image</a></div>`;
          resDiv.innerHTML += `<div><a href="music_${tamga}.mid" style="color:#0ff;">Download MIDI</a></div>`;
        }
      });
    });
  </script>
</body>
</html>